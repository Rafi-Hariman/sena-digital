<!-- responsive card -->
<body class="bg-light">
  <div class="container-fluid p-4">
    <!-- Loading Overlay -->
    <div class="loading-overlay" *ngIf="isLoading">
      <div class="spinner-container">
        <div class="spinner"></div>
        <p class="loading-text">Memuat data...</p>
      </div>
    </div>

    <div class="row">
      <div class="col-12" style="padding: 0px;">

        <!-- Countdown Configuration Section -->
        <div class="col-12 mb-4">
          <div class="card-custom">
            <h2 class="title-border">Pengaturan Countdown</h2>
            <form class="row g-3 align-items-end" [formGroup]="countdownForm" (ngSubmit)="onCountdownSubmitClicked()">
              <div class="col-12 col-lg">
                <label for="countdown" class="form-label">Nama Countdown Acara</label>
                <input
                  type="text"
                  id="countdown"
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid(countdownForm, 'name_countdown')"
                  placeholder="Contoh: Wedding Countdown"
                  formControlName="name_countdown" />
                <div class="invalid-feedback" *ngIf="isFieldInvalid(countdownForm, 'name_countdown')">
                  {{ getFieldError(countdownForm, 'name_countdown') }}
                </div>
              </div>
              <div class="col-12 col-lg-auto">
                <div class="d-flex gap-2 flex-wrap">
                  <button type="button" class="btn btn-update" (click)="onCountdownUpdateClicked()"
                    *ngIf="hasCountdown()" [disabled]="isLoading || countdownForm.invalid">
                    <i class="fas fa-edit me-2"></i>Update Countdown
                  </button>
                  <button type="submit" class="btn btn-simpan"
                    *ngIf="!hasCountdown()" [disabled]="isLoading || countdownForm.invalid">
                    <i class="fas fa-plus me-2"></i>Simpan Countdown
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Event Management Section -->
        <div class="col-12">

          <!-- Existing Events Display -->
          <div class="existing-events-section" *ngIf="hasEvent('akad') || hasEvent('resepsi')">
            <h3 class="section-title">Acara yang Sudah Dibuat</h3>

            <div class="row g-3 mb-4">
              <!-- Akad Event Card -->
              <div class="col-md-6" *ngIf="hasEvent('akad')">
                <div class="event-card akad-card">
                  <div class="event-header">
                    <div class="event-type-badge akad-badge">
                      <i class="fas fa-mosque me-2"></i>{{ getEventTypeLabel('akad') }}
                    </div>
                    <div class="event-actions">
                      <button type="button" class="btn btn-sm btn-outline-primary"
                        (click)="onEventTypeSelect('akad')" [disabled]="isLoading">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button type="button" class="btn btn-sm btn-outline-danger"
                        (click)="deleteEvent('akad')" [disabled]="isLoading">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                  <div class="event-content">
                    <h5 class="event-name">{{ akadEvent?.nama_acara }}</h5>
                    <div class="event-details">
                      <p><i class="fas fa-calendar me-2"></i>{{ formatDate(akadEvent?.tanggal_acara || null) }}</p>
                      <p><i class="fas fa-clock me-2"></i>{{ akadEvent?.start_acara }} - {{ akadEvent?.end_acara }}</p>
                      <p><i class="fas fa-map-marker-alt me-2"></i>{{ akadEvent?.alamat }}</p>

                    </div>
                  </div>
                </div>
              </div>

              <!-- Resepsi Event Card -->
              <div class="col-md-6" *ngIf="hasEvent('resepsi')">
                <div class="event-card resepsi-card">
                  <div class="event-header">
                    <div class="event-type-badge resepsi-badge">
                      <i class="fas fa-glass-cheers me-2"></i>{{ getEventTypeLabel('resepsi') }}
                    </div>
                    <div class="event-actions">
                      <button type="button" class="btn btn-sm btn-outline-primary"
                        (click)="onEventTypeSelect('resepsi')" [disabled]="isLoading">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button type="button" class="btn btn-sm btn-outline-danger"
                        (click)="deleteEvent('resepsi')" [disabled]="isLoading">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                  <div class="event-content">
                    <h5 class="event-name">{{ resepsiEvent?.nama_acara }}</h5>
                    <div class="event-details">
                      <p><i class="fas fa-calendar me-2"></i>{{ formatDate(resepsiEvent?.tanggal_acara || null) }}</p>
                      <p><i class="fas fa-clock me-2"></i>{{ resepsiEvent?.start_acara }} - {{ resepsiEvent?.end_acara }}</p>
                      <p><i class="fas fa-map-marker-alt me-2"></i>{{ resepsiEvent?.alamat }}</p>

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Event Type Selection -->
          <div class="event-type-selection" *ngIf="!showEventForm && hasCountdown()">
            <div class="event-type-selector">
              <div class="row g-3">
                <div class="col-md-6" *ngFor="let eventType of getAvailableEventTypes()">
                  <button type="button" class="btn btn-event-type w-100"
                    (click)="onEventTypeSelect(eventType.key)" [disabled]="isLoading">
                    <div class="event-type-content">
                      <i class="fas" [class.fa-mosque]="eventType.key === 'akad'"
                        [class.fa-glass-cheers]="eventType.key === 'resepsi'"></i>
                      <h5>{{ eventType.label }}</h5>
                      <p class="text-muted">
                        {{ eventType.key === 'akad' ? 'Acara akad nikah dengan penghulu' : 'Acara resepsi pernikahan' }}
                      </p>
                    </div>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- No Countdown Warning -->
          <div class="alert alert-warning" *ngIf="!hasCountdown()">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>Perhatian!</strong> Silakan buat countdown terlebih dahulu sebelum menambah acara.
          </div>

          <!-- Event Form -->
          <div class="event-form-container" *ngIf="showEventForm && selectedEventType">
            <div class="card-custom">
              <div class="form-header">
                <h3 class="title">
                  <i class="fas me-2" [class.fa-mosque]="selectedEventType === 'akad'"
                    [class.fa-glass-cheers]="selectedEventType === 'resepsi'"></i>
                  {{ hasEvent(selectedEventType) ? 'Edit' : 'Tambah' }} {{ getEventTypeLabel(selectedEventType) }}
                </h3>
                <button type="button" class="btn btn-outline-secondary" (click)="cancelEventForm()">
                  <i class="fas fa-times"></i>
                </button>
              </div>

              <!-- Akad Form -->
              <form *ngIf="selectedEventType === 'akad'" [formGroup]="akadForm" (ngSubmit)="onEventSubmitClicked()">

                <!-- Basic Event Info -->
                <div class="form-section">
                  <h5 class="section-subtitle">Informasi Dasar</h5>

                  <div class="row g-3">
                    <div class="col-12">
                      <label for="akadNamaAcara" class="form-label">Nama Acara *</label>
                      <input type="text" class="form-control" id="akadNamaAcara"
                        [class.is-invalid]="isFieldInvalid(akadForm, 'nama_acara')"
                        placeholder="Contoh: Akad Nikah Ahmad & Siti"
                        formControlName="nama_acara" [disabled]="isLoading" />
                      <div class="invalid-feedback" *ngIf="isFieldInvalid(akadForm, 'nama_acara')">
                        {{ getFieldError(akadForm, 'nama_acara') }}
                      </div>
                    </div>

                    <div class="col-md-4">
                      <label for="akadTanggal" class="form-label">Tanggal *</label>
                      <div class="input-icon">
                        <input type="text" class="form-control" id="akadTanggal"
                          [class.is-invalid]="isFieldInvalid(akadForm, 'tanggal_acara')"
                          placeholder="Pilih tanggal" formControlName="tanggal_acara"
                          bsDatepicker [bsConfig]="bsConfig" readonly [disabled]="isLoading" />
                        <i class="far fa-calendar-alt"></i>
                      </div>
                      <div class="invalid-feedback" *ngIf="isFieldInvalid(akadForm, 'tanggal_acara')">
                        {{ getFieldError(akadForm, 'tanggal_acara') }}
                      </div>
                    </div>

                    <div class="col-md-4">
                      <label for="akadWaktuMulai" class="form-label">Waktu Mulai *</label>
                      <input type="time" class="form-control" id="akadWaktuMulai"
                        [class.is-invalid]="isFieldInvalid(akadForm, 'start_acara')"
                        formControlName="start_acara" [disabled]="isLoading" />
                      <div class="invalid-feedback" *ngIf="isFieldInvalid(akadForm, 'start_acara')">
                        {{ getFieldError(akadForm, 'start_acara') }}
                      </div>
                    </div>

                    <div class="col-md-4">
                      <label for="akadWaktuSelesai" class="form-label">Waktu Selesai *</label>
                      <input type="time" class="form-control" id="akadWaktuSelesai"
                        [class.is-invalid]="isFieldInvalid(akadForm, 'end_acara')"
                        formControlName="end_acara" [disabled]="isLoading" />
                      <div class="invalid-feedback" *ngIf="isFieldInvalid(akadForm, 'end_acara')">
                        {{ getFieldError(akadForm, 'end_acara') }}
                      </div>
                    </div>
                  </div>
                </div>



                <!-- Location Info -->
                <div class="form-section">
                  <h5 class="section-subtitle">Informasi Lokasi</h5>

                  <div class="row g-3">
                    <div class="col-12">
                      <label for="akadAlamat" class="form-label">Alamat Lengkap *</label>
                      <textarea class="form-control" id="akadAlamat" rows="3"
                        [class.is-invalid]="isFieldInvalid(akadForm, 'alamat')"
                        formControlName="alamat" placeholder="Masukkan alamat lengkap tempat akad"
                        [disabled]="isLoading"></textarea>
                      <div class="invalid-feedback" *ngIf="isFieldInvalid(akadForm, 'alamat')">
                        {{ getFieldError(akadForm, 'alamat') }}
                      </div>
                    </div>

                    <div class="col-12">
                      <label for="akadLinkLokasi" class="form-label">Link Google Maps *</label>
                      <input type="url" class="form-control" id="akadLinkLokasi"
                        [class.is-invalid]="isFieldInvalid(akadForm, 'link_maps')"
                        placeholder="https://maps.google.com/..." formControlName="link_maps"
                        [disabled]="isLoading" />
                      <div class="invalid-feedback" *ngIf="isFieldInvalid(akadForm, 'link_maps')">
                        {{ getFieldError(akadForm, 'link_maps') }}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Submit Button -->
                <div class="form-actions">
                  <button type="button" class="btn btn-cancel me-3" (click)="cancelEventForm()" [disabled]="isLoading">
                    Batal
                  </button>
                  <button type="submit" class="btn btn-save" [disabled]="isLoading || akadForm.invalid">
                    {{ hasEvent('akad') ? 'Update Akad' : 'Simpan Akad' }}
                  </button>
                </div>
              </form>

              <!-- Resepsi Form -->
              <form *ngIf="selectedEventType === 'resepsi'" [formGroup]="resepsiForm" (ngSubmit)="onEventSubmitClicked()">

                <!-- Basic Event Info -->
                <div class="form-section">
                  <h5 class="section-subtitle">Informasi Dasar</h5>

                  <div class="row g-3">
                    <div class="col-12">
                      <label for="resepsiNamaAcara" class="form-label">Nama Acara *</label>
                      <input type="text" class="form-control" id="resepsiNamaAcara"
                        [class.is-invalid]="isFieldInvalid(resepsiForm, 'nama_acara')"
                        placeholder="Contoh: Resepsi Pernikahan Ahmad & Siti"
                        formControlName="nama_acara" [disabled]="isLoading" />
                      <div class="invalid-feedback" *ngIf="isFieldInvalid(resepsiForm, 'nama_acara')">
                        {{ getFieldError(resepsiForm, 'nama_acara') }}
                      </div>
                    </div>

                    <div class="col-md-4">
                      <label for="resepsiTanggal" class="form-label">Tanggal *</label>
                      <div class="input-icon">
                        <input type="text" class="form-control" id="resepsiTanggal"
                          [class.is-invalid]="isFieldInvalid(resepsiForm, 'tanggal_acara')"
                          placeholder="Pilih tanggal" formControlName="tanggal_acara"
                          bsDatepicker [bsConfig]="bsConfig" readonly [disabled]="isLoading" />
                        <i class="far fa-calendar-alt"></i>
                      </div>
                      <div class="invalid-feedback" *ngIf="isFieldInvalid(resepsiForm, 'tanggal_acara')">
                        {{ getFieldError(resepsiForm, 'tanggal_acara') }}
                      </div>
                    </div>

                    <div class="col-md-4">
                      <label for="resepsiWaktuMulai" class="form-label">Waktu Mulai *</label>
                      <input type="time" class="form-control" id="resepsiWaktuMulai"
                        [class.is-invalid]="isFieldInvalid(resepsiForm, 'start_acara')"
                        formControlName="start_acara" [disabled]="isLoading" />
                      <div class="invalid-feedback" *ngIf="isFieldInvalid(resepsiForm, 'start_acara')">
                        {{ getFieldError(resepsiForm, 'start_acara') }}
                      </div>
                    </div>

                    <div class="col-md-4">
                      <label for="resepsiWaktuSelesai" class="form-label">Waktu Selesai *</label>
                      <input type="time" class="form-control" id="resepsiWaktuSelesai"
                        [class.is-invalid]="isFieldInvalid(resepsiForm, 'end_acara')"
                        formControlName="end_acara" [disabled]="isLoading" />
                      <div class="invalid-feedback" *ngIf="isFieldInvalid(resepsiForm, 'end_acara')">
                        {{ getFieldError(resepsiForm, 'end_acara') }}
                      </div>
                    </div>
                  </div>
                </div>



                <!-- Location Info -->
                <div class="form-section">
                  <h5 class="section-subtitle">Informasi Lokasi</h5>

                  <div class="row g-3">
                    <div class="col-12">
                      <label for="resepsiAlamat" class="form-label">Alamat Lengkap *</label>
                      <textarea class="form-control" id="resepsiAlamat" rows="3"
                        [class.is-invalid]="isFieldInvalid(resepsiForm, 'alamat')"
                        formControlName="alamat" placeholder="Masukkan alamat lengkap tempat resepsi"
                        [disabled]="isLoading"></textarea>
                      <div class="invalid-feedback" *ngIf="isFieldInvalid(resepsiForm, 'alamat')">
                        {{ getFieldError(resepsiForm, 'alamat') }}
                      </div>
                    </div>

                    <div class="col-12">
                      <label for="resepsiLinkLokasi" class="form-label">Link Google Maps *</label>
                      <input type="url" class="form-control" id="resepsiLinkLokasi"
                        [class.is-invalid]="isFieldInvalid(resepsiForm, 'link_maps')"
                        placeholder="https://maps.google.com/..." formControlName="link_maps"
                        [disabled]="isLoading" />
                      <div class="invalid-feedback" *ngIf="isFieldInvalid(resepsiForm, 'link_maps')">
                        {{ getFieldError(resepsiForm, 'link_maps') }}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Submit Button -->
                <div class="form-actions">
                  <button type="button" class="btn btn-cancel me-3" (click)="cancelEventForm()" [disabled]="isLoading">
                    Batal
                  </button>
                  <button type="submit" class="btn btn-save" [disabled]="isLoading || resepsiForm.invalid">
                    {{ hasEvent('resepsi') ? 'Update Resepsi' : 'Simpan Resepsi' }}
                  </button>
                </div>
              </form>

            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</body>
