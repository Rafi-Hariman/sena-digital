<div class="container-fluid px-3 px-md-4">

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Loading themes...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !isLoading" class="alert alert-danger" role="alert">
    <h5 class="alert-heading">Error Loading Themes</h5>
    <p>{{ errorMessage }}</p>
    <button class="btn btn-outline-danger" (click)="retryLoadThemes()">
      <i class="fas fa-redo"></i> Retry
    </button>
  </div>

  <!-- Theme Cards Grid -->
  <div *ngIf="!isLoading && !errorMessage" class="row g-3 g-md-4 justify-content-center">
    <div
      *ngFor="let theme of themeCards; trackBy: trackByThemeId"
      class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-3 d-flex">

      <div class="card-custom w-100" [ngClass]="getBackgroundClass(theme.label)">
        <div class="side-bar"></div>

        <!-- Card Header -->
        <div class="card-header">
          <h3>{{ theme.label }}</h3>
          <i class="fas fa-trash-alt" title="Delete"></i>
        </div>

        <!-- Theme Image -->
        <div class="card-img-container">
          <img
            [src]="theme.image"
            [alt]="'Preview for ' + theme.name + ' theme'"
            (error)="onImageError($event, theme)"
            loading="lazy" />
        </div>

        <!-- Theme Title -->
        <h4 class="card-title">{{ theme.name }}</h4>

        <!-- Theme Price (if not free) -->
        <div *ngIf="theme.price > 0" class="text-muted mb-2 small">
          {{ formatPrice(theme.price) }}
        </div>

        <!-- Action Buttons -->
        <div class="card-buttons">
          <!-- Demo Button -->
          <button
            type="button"
            class="btn-demo"
            (click)="onDemoClick(theme)"
            [disabled]="!theme.demo_url">
            <i class="far fa-eye"></i>
            <span class="btn-text">Demo</span>
          </button>

          <!-- Select/Selected Button -->
          <button
            type="button"
            class="btn-nonaktifkan"
            [class.btn-success]="theme.isSelected"
            [class.btn-secondary]="!theme.isSelected"
            (click)="onToggleActivation(theme)"
            [disabled]="isThemeLoading(theme)">
            <i [class]="getActivationButtonIcon(theme)"></i>
            <span class="btn-text">{{ getActivationButtonText(theme) }}</span>
          </button>
        </div>

        <!-- Selected Badge -->
        <div *ngIf="theme.isSelected" class="position-absolute top-0 end-0 m-2">
          <span class="badge bg-success">
            <i class="fas fa-check"></i> Active
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && !errorMessage && themeCards.length === 0" class="text-center py-5">
    <i class="fas fa-palette fa-3x text-muted mb-3"></i>
    <h5>No Themes Available</h5>
    <p class="text-muted">No themes are currently available for website invitations.</p>
    <button class="btn btn-primary" (click)="retryLoadThemes()">
      <i class="fas fa-refresh"></i> Refresh
    </button>
  </div>

</div>
